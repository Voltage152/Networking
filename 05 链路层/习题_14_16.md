#### P14 如图 5-33 所示，考虑通过两台路由器互联的 3 个局域网。
#### a. 对所有接口分配 IP 地址。对子网 1 使用形式为 192.168.1.xxx 的地址，对子网 2 使用形式为 192.168.2.xxx 的地址，对子网 3 使用形式为 192.168.3.xxx 的地址。
#### b. 为所有适配器分配 MAC 地址。
#### c. 考虑从主机 E 向主机 B 发送一个 IP 数据报。假设所有 ARP 表都是最新的。就像在 5.4.1 节中对单路路由器例子所做的那样，列出所有步骤。
#### d. 重复 (c)，现在假设在发送主机中的 ARP 表为空（并且其他表都是最新的）。

![](https://github.com/YangXiaoHei/Networking/blob/master/05%20链路层/images/p14.png)

  * a.
    * ![](https://github.com/YangXiaoHei/Networking/blob/master/05%20链路层/images/p14.1.png)

  * b.
    * ![](https://github.com/YangXiaoHei/Networking/blob/master/05%20链路层/images/p14.2.png)
    
  * c.
    * E 的链路层打包网络层数据报，因为 B 的 IP 192.168.1.1 是跨网段的，所以E 从 ARP 表中找出网关路由器 R2 的 IP 192.168.3.1 (从 DHCP ACK 报文中获得) 对应的的 MAC 地址 HH-HH-HH-HH-HH-HH 作为目的 MAC 地址。
    
    * E 将该帧发到局域网中。
    
    * E 所在局域网的交换机 S3 收到该帧，于是检查自己的交换表，若其中有网关路由器 MAC 地址对应的表项，那么就转发到指定端口。若没有，那么向除了来路外的所有端口广播该帧，于是 F 将收到该帧，F 的适配器检查到该帧不是向自己寻址后将其丢弃。
    
    * 接下来网关路由器 R3 的适配器收到了该帧，确认了是向自己寻址的帧后，拆封向上交给网络层，于是检查自己的转发表，决定恰当的端口进行转发。
    
    * 在路由器恰当的输出端口适配器中，由于路由器的 ARP 表是最新的，所以路由器查找到了下一跳路由器 R1 的 MAC 地址 DD-DD-DD-DD-DD-DD，将其作为帧的目的 MAC，然后转发出去。
    
    * 当中间的交换机 S2 收到此帧，检查自己的交换表，有记录则转发。无记录则广播。
    
    * 现在最左边的路由器 R1 收到了该帧，确认好是向自己寻址的帧后，向上交给网络层，网络层检查自己的转发表决定转发端口，由于这是子网 1 的网关路由器，因此该网关路由器的 ARP 表中具有目的主机的 MAC 地址 CC-CC-CC-CC-CC-CC，所以将其作为目的 MAC 地址填写。
    
    * 子网 1 的交换机 S1 收到帧，有记录则转发，无记录则广播。
    
    * 目的主机收到向自己寻址的帧，将其拆封，并交给上层协议栈。
    
  * d.
    * 用嘴说一下吧...只是在每台路由器和主机 E 封装链路层帧时都先使用 ARP 查找了 IP 对应的 MAC 地址。并且在此 ARP 请求和应答的过程中，交换机学习到了所有相关路径的 MAC <-> 端口映射关系。