
[P19 考虑向具有 700 字节 MTU 的一条链路发送一个 2400 字节的数据报。假定初始数据报标有标示号 422。将会生成多少个分片？在生成相关分片的数据报中的各个字段中的值是多少？](#P19)

#### P1 在本题中，考虑虚电路网络和数据报网络的某些优缺点。
#### a. 假设路由器遇到了可能经常会引起它无法正常运转的情况。提出理由说明是虚电路体系结构还是数据报体系结构更好？为什么？
#### b. 对于源和目的结点间传输流量的排他性使用，假设该源和目的结点要求，在沿源到目的地的路径上的所有路由器总能提供固定的容量。提出理由说明是虚电路体系结构还是数据报体系结构更好？为什么？
#### c. 假设网络中的链路和路由器从不出故障，并且所有源/目的地对之间所使用的路径保持不变。在这种情况下，虚电路或数据报体系结构哪个控制流量开销会更多,为什么？

  * a.
    * 数据报网络更好，即使一个结点发生故障，那么 RIP 会通告该路由的不可达信息，OSPF 也会作出如此通告，那么路由选择算法必定不会选择经过该故障路由器的路径。而虚电路网络在初期连接建立阶段已经确定了唯一的路径，如果其中某个路由器发生故障，那么该连接将失效。
  * b.
    * 源和目的结点要求，所有源到目的路径上的路由器总能提供固定容量，那么这需要路由器知道流量的特征，对于虚电路网络，在连接建立阶段的握手报文在每一台路由器上都进行了约定协商，因此对于虚电路体系结构，这是可能的。比如 ATM 的 CBR
  * c.
    * 数据报体系的流量开销更多，因为每个分组都携带了很多字节的头部控制信息(比如 IPv4 20 字节，IPv6 40 字节)，从而决定路由的方式。而虚电路体系结构在连接建立阶段就建立了一条电路，并且始终不变，因此分组只需要一个轻量级的头部就可以。

#### P2 考虑一个虚电路网络。假定其 VC 号是一个 8 比特字段。
#### a. 链路能够承载的虚电路的最大数量是多少？
#### b. 假定某中心结点在连接建立时确定了路径和 VC 号。假定沿着某虚电路的路径在每段链路使用相同的 VC 号。描述在连接建立时中心结点如何确定 VC 号。进行中虚电路比在 (a) 中确定的最大值要少，也没有相同的未用 VC 号，这种情况可能出现吗？
#### c. 假定沿着某条虚电路的路径允许不同的 VC 号。在连接建立期间，在端到端路径确定以后，描述链路如何以分散方式而不依赖中心结点选择它们的 VC 号并配置它们的转发表。

 * a.
   * 2^8 - 1 = 255 所以最大数量为 0 ~ 255 即 256 个。
  
 * b.  // TODO
 * c.  // TODO

#### P3 在虚电路网络中的基本转发表具有 4 列。在这些列中的值的含义是什么？在数据报网络中的基本转发表有两列。在这些列中的值的含义是什么？

 * 输入链路端口号，入 VC 号，输出链路端口号，出 VC 号。
 * 目的子网前缀，输出链路端口号。

#### P4 考虑下列网络。
#### a. 假定网络是一个数据报网络。写出路由器 A 中的转发表，从而满足所有指向主机 H3 的流量都通过接口 3 转发。
#### b. 假定网络是一个数据报网络。你能写出路由器 A 中的转发表从而满足其中所有从 H1 指向主机 H3 的流量通过接口 3 转发，而所有从 H2 指向主机 H3 的流量通过接口 4 转发。（提示：这是一个技巧问题）
#### c. 现在假定网络是虚电路网络，在 H1 和 H3 之间有一个进行中的呼叫，H2 和 H3 之间有另一个进行中的呼叫。写出路由器 A 中的转发表，其中所有从 H1 指向主机 H3 的流量通过接口 3 转发，而所有从 H2 指向主机 H3 的流量通过接口 4 转发。
#### d. 假设场景与 (c) 中相同，写出在结点 B, C 和 D 中的转发表。
  ![](https://github.com/YangXiaoHei/Networking/blob/master/04%20网络层/images/p4.png)
  
  * a.
  
	|目的子网前缀 | 出端口号 |
	|:---:|:---:|
	|H3|3|
	
  * b.
    * 不能，因为转发表是根据目的地来区分的，而不是源地址。
    
  * c.
  
	   |入端口号|入 VC 号|出端口号|出 VC 号|
	   |:---:|:---:|:---:|:----:|
	   |1|22|3|44|
	   |2|23|4|45|

   * 当然 VC 号也可以相同
      
	   |入端口号|入 VC 号|出端口号|出 VC 号|
	   |:---:|:---:|:---:|:----:|
	   |1|22|3|22|
	   |2|33|4|33|

  * d.
    * Router A
    
      |入端口号|入 VC 号|出端口号|出 VC 号|
	   |:---:|:---:|:---:|:----:|
	   |1|22|3|44|
	   |2|23|4|45|
    
    * Router B

      |入端口号|入 VC 号|出端口号|出 VC 号|
	   |:---:|:---:|:---:|:----:|
	  |1|44|2|55|
    
    * Router C

	   |入端口号|入 VC 号|出端口号|出 VC 号|
	   |:---:|:---:|:---:|:----:|
	   |1|45|2|66|
    
    * Router D
	
	   |入端口号|入 VC 号|出端口号|出 VC 号|
	   |:---:|:---:|:---:|:----:|
	   |1|55|3|66|
	   |2|66|3|55|

#### P5 考虑一个用 2 比特字段表示 VC 号的虚电路网络。假定该网络要通过 4 条链路 (链路 A、链路 B、链路 C 和链路 D) 建立一条虚电路。假定这些链路中的每条当前都要承载两条其他的虚电路，这些其他虚电路的 VC 号如下:

|链路 A|链路 B| 链路 C| 链路 D|
|:---:|:---:|:---:|:---:|
|00|01|10|11|
|01|10|11|00|

#### 在回答下列问题时，记住每个现有的虚电路可能通过这 4 条链路之一。
#### a. 如果每条虚电路要求沿着其路径使用相同的 VC 号，能为该新的虚电路分配什么样的 VC 号？
#### b. 如果每条虚电路沿着其路径允许不同的链路使用不同的 VC 号 (因此转发表必须执行 VC 号转换)，能够使用 4 个 VC 号的多少种不同的组合 (一种组合用于这 4 条链路之一)？

![](https://github.com/YangXiaoHei/Networking/blob/master/04%20网络层/images/p5.png)
 
  * a.
    * A 已经用了 0 和 1，那么通过 A 只能用 2 或 3，发现 B 用了 2 ，那么只能用 3，然后发现 C 用了 3，那么就说明已经无法为新的虚电路分配 VC 号了。 
    
  * b.
    * A 还可以用 2 3，B 还可以用 0 3，C 还可以用 0 1， D 还可以用 1 2，所以就是 `2 x 2 x 2 x 2 = 16` 种 

#### P6 在本书中我们使用术语面向连接来描述运输层服务，使用术语连接服务描述网络层服务。在术语中为何有这种微妙的差异？

  * 因为网络层的连接服务中，每个路由器都维护了连接的状态。而在运输层的 TCP 协议中，是构建在路由器不维护连接状态的基础上，由两个端系统维护了连接的状态，因此是面向连接的。

#### P7 假设两个分组在完全相同的时刻到达一台路由器的两个不同输入端口。同时假设在该路由器中没有其他分组。
#### a. 假设这两个分组朝着不同的输出端口转发。当交换结构使用一条共享总线时，这两个分组能在相同时刻朝着交换结构转发吗？
#### b. 假设这两个分组朝着两个不同的输出端口转发，当交换结构使用纵横式时，这两个分组可能在形同时刻通过交换结构转发吗？
#### c. 假设这两个分组朝着相同的输出端口转发。当交换结构使用纵横方式时，这两个分组可能在相同时刻通过交换结构转发吗？

 * a.
   * 不能
 
 * b.
   * 能
 
 * c.
   * 不能
  
#### P8 在 4.3 节中，我们注意到如果交换结构比输入线路速率快 n 倍，其最大的排队时延为 `(n - 1)D`。假设所有分组有相同长度，在相同时刻 n 个分组到达 n 个输入端口，同时所有 n 个分组要转发到不同的输出端口。对于内存，总线和纵横式交换结构，一个分组的最大时延是多少？

  * 内存 : `(n - 1)D`
  * 总线 : `(n - 1)D`
  * 纵横式 : `0`

#### P9 考虑下列交换机。假设所有数据报具有相同长度，交换机以一种分时隙、同步的方式运行，在一个时隙中一个数据报能够从某输入端口传送到某输出端口。其交换结构是纵横式的，因此在一个时隙中至多一个数据报能够传送到一个给定输出端口，但在一个单一时隙中不同的输出端口能够接受到来自不同输入端口的数据报，从输入端口到它们的输出端口传送所示的分组，所需的时隙数量最少是多少？此时假定使用你所需要的任何输入排队调度方法（即此时没有 HOL 阻塞）。假定你才用你能够设计的最差情况下的调度方案，假定非空输入队列不会空闲，所需的时隙数量最大是多少？

![](https://github.com/YangXiaoHei/Networking/blob/master/04%20网络层/images/p9.png)

  * 最少是 3，步骤如下
    * 第一个时隙 : X Y
    * 第二个时隙 : X Y
    * 第三个时隙 : Z
    
  * 最大也是 3，因为非空输入队列不会空闲，你不能懒着不转发包，因此假定是如下步骤
    * 第一个时隙 : X Y
    * 第二个时隙 : X Z (调度方案避免 HOL 阻塞)
    * 第三个时隙 : Y
    * 因此怎么搞都是 3 个时隙。
 
#### P10 考虑使用 32 比特主机地址的某数据报网络。假定一台路由器具有 4 条链路，编号为 0 ~ 3，分组被转发到如下的各链路端口

|目的地址范围|链路接口|
|:---:|:---:|
| `1110 0000 0000 0000 0000 0000 0000 0000` 到 `1110 0000 0011 1111 1111 1111 1111 1111` | 0 |
| `1110 0000 0100 0000 0000 0000 0000 0000` 到 `1110 0000 0100 0000 1111 1111 1111 1111` | 1 |
| `1110 0000 0100 0001 0000 0000 0000 0000` 到 `1110 0001 0111 1111 1111 1111 1111 1111` | 2 |
| 其他 | 3 |

#### a. 提供一个具有 4 个表项的转发表，使用最长前缀匹配，转发分组到正确的链路接口。
#### b. 描述你的转发表是如何为具有下列目的地址的数据报决定适当链路接口的。
#### 1100 1000 1001 0001 0101 0001 0101 0101
#### 1110 0001 0100 0000 1100 0011 0011 1100
#### 1110 0001 1000 0000 0001 0001 0111 0111

 * a.
 
   |子网前缀|端口号|
   |:---:|:----:|
   | `1110 0000 00` |0|
   | `1110 0000 0100 0000` |1|
   | `1110 000` |2|
   | `1110 0001 1` |3|
   | 其他 | 3 |
   
* b.
 * 对于地址 `1100 1000 1001 0001 0101 0001 0101 0101` 进行最长前缀匹配，发现它能匹配的是端口 3
 * 对于地址 `1110 0001 0100 0000 1100 0011 0011 1100` 进行最长前缀匹配，发现它能匹配的是端口 2
 * 对于地址 `1110 0001 1000 0000 0001 0001 0111 0111` 进行最长前缀匹配，发现它能匹配的是端口 3

#### P11 考虑使用 8 比特主机地址的某数据报网络。假定一台路由器使用最长前缀匹配并具有下列转发表

|前缀匹配|接口|
|:---:|:---:|
|00|0|
|010|1|
|011|2|
|10|2|
|11|3|

####  对这 4 个接口中的每个，给出相应的目的主机地址的范围和在该范围中的地址数量。

* 对于端口 0
  * `0.0.0.0 ~ 63.255.255.255` 总共有 `2^30 = 1073741824` 个地址
  
* 对于端口 1
  * `64.0.0.0 ~ 95.255.255.255` 总共有 `2^30 + 2^29 - 2^30 = 2^29 = 536870912`
 
* 对于端口 2
  * `96.0.0.0 ~ 127.255.255.255` 总共有 `536870912`
  
* 对于端口 2
  * `128.0.0.0 ~ 191.255.255.255` 总共有 `1073741824` 个地址
  * 对于端口 2，总共有 `1610612734` 个地址

* 对于端口 3
  * `192.0.0.0 ~ 255.255.255.255` 总共有 `1073741824` 个地址

#### P12 考虑使用 8 比特主机地址的数据报网络，假定一台路由器使用最长前缀匹配并具有下列转发表。

|前缀匹配|接口|
|:---:|:---:|
|1|0|
|10|1|
|111|2|
|其他|3|

#### 对这 4 个接口中的每个，给出相应的目的主机地址的范围和在该范围中的地址数量。

  * 对于端口 0
    *  范围是 `1100 0000 ~ 1101 1111`  总共有 `2^5 = 32` 个地址 
    
  * 对于端口 1
    * 范围是 `1000 0000 ~ 1011 1111` 总共有 `2^6 = 64` 个地址
    
  * 对于端口 2
    * 范围是 `1110 0000 ~ 1111 1111` 总共有 `2^5 = 32` 个地址
    
  * 对于端口 3
  	 * 范围是 `0000 0000 ~ 0111 1111` 总共有 `128` 个地址

#### P13 考虑互联 3 个子网 (子网 1、子网 2 和子网 3) 的一台路由器。假定在这 3 个子网的每个子网中的所有接口要求具有前缀 `223.1.17/24`。还假定子网 1 要求支持多达 60 个接口，子网 2 要求支持多达 90 个接口和子网 3 要求支持多达 12 个接口。提供 3 个满足这些限制的网络地址 (形式为 `a.b.c.d/x`)。

  * 要求支持多达 60 个接口，那就分配给它 64 个，这需要 6 个比特，因此 `223.1.17.0/26`
  * 要求支持多达 90 个接口，那就分配给它 128 个，这需要 7 个比特，因此 `223.1.17.128/25`
  * 要求支持多达 12 个接口，那就分配给它 16 个，这需要 4 个比特，因此 `23.1.17.192/28`

#### P14 在 4.2.2 节中给出了一个转发表 (使用最长前缀匹配)。使用 `a.b.c.d/x` 记法代替二进制字符串记法，重写该转发表。

|前缀匹配|链路接口|
|:---:|:---:|
|`200.23.16/21`|0|
|`200.23.24/24`|1|
|`200.23.24/21`|2|
|其他|3|
  

#### P15 在习题 P10 中要求你给转发表（使用最长前缀匹配）。使用 `a.b.c.d/x` 记法代替二进制字符串记法，重写该转发表。

|目的地址范围|链路接口|
|:---:|:---:|
| `1110 0000 0000 0000 0000 0000 0000 0000`  `1110 0000 0011 1111 1111 1111 1111 1111` | 0 |
| `1110 0000 0100 0000 0000 0000 0000 0000`  `1110 0000 0100 0000 1111 1111 1111 1111` | 1 |
| `1110 0000 0100 0001 0000 0000 0000 0000`  `1110 0001 0111 1111 1111 1111 1111 1111` | 2 |
| 其他 | 3 |

|子网前缀|端口号|
|:---:|:----:|
| `1110 0000 00` |0|
| `1110 0000 0100 0000` |1|
| `1110 000` |2|
| `1110 0001 1` |3|
| 其他 | 3 |

|子网前缀|端口号|
|:---:|:----:|
| `224.0/10` |0|
| `224.64/16` |1|
| `224/7` |2|
| `225.128/9` |3|
| 其他 | 3 |

#### P16 考虑具有前缀 `128.119.40.128/26` 的一个子网。给出能被分配给该网络的一个 IP 地址（形式为 `xxx.xxx.xxx.xxx`）的例子。假定一个 ISP 拥有形式为 `128.119.40.64/26` 的地址块。假定它要从该地址块生成 4 个子网，每块具有相同数量的 IP 地址。这 4 个子网（形式为 `a.b.c.d/x`）的前缀是什么？

  * `128.119.40.128/26` 写成二进制字符串
    * `119 = 64 + 32 + 16 + 4 + 2 + 1 = 0111 0111`
    * `40 = 32 + 8 = 0010 1000`
    * 最终结果为 `10000000 01110111 00101000 00` 
    * 所以能够分配给该网络的一个 IP 地址为 `128.119.40.32`

  * `128.119.40.64/26` 写成二进制字符串
    * `10000000 01110111 00101000 01` 剩下 6 个比特来分配 IP 地址，故总共可以使用的 IP 地址有 `2^6` 个即 64 个，那么要分成 4 个子网，即每个子网 16 个。因此子网划分如下
    
    |地址范围|
    |:---:|
    |`10000000 01110111 00101000 01000000` `10000000 01110111 00101000 01001111`|
    |`10000000 01110111 00101000 01010000` `10000000 01110111 00101000 01011111`|
    |`10000000 01110111 00101000 01100000` `10000000 01110111 00101000 01101111` |
    |`10000000 01110111 00101000 01110000` `10000000 01110111 00101000 01111111` |
    
    |前缀匹配|
    |:---:|
    |`10000000 01110111 00101000 0100`|
    |`10000000 01110111 00101000 0101`|
    |`10000000 01110111 00101000 0110`|
    |`10000000 01110111 00101000 0111`|
    
    |前缀匹配|
    |:---:|
    |`128.119.40.64/28`|
    |`128.119.40.80/28`|
    |`128.119.40.96/28`|
    |`128.119.40.112/28`|



#### P17 考虑图 4-17 中显示的拓扑。（在 12:00 以顺时针开始）标记具有主机的 3 个子网为网络 A、B 和 C。标记没有主机的子网为网络 D、E 和 F。
#### a. 为这 6 个子网分配网络地址，要满足下列限制：所有地址必须从 `214.97.254/23` 起分配；子网 A 应当具有足够地址以支持 250 个接口；子网 B 应当具有足够地址以支持 120 个接口；子网 C 应当具有足够地址以支持 120 个接口。当然，子网 D、E 和 F 应当支持两个接口。对于每个子网，分配采用的形式是 `a.b.c.d/x` 或 `a.b.c.d/x ~ e.f.g.h/y`
#### b. 使用你对（a）部分的答案，为这 3 台路由器中的每台都提供转发表（使用最长前缀匹配）

  * a.
    * `214.97.254/23` 剩下 9 个比特用来分配 IP 地址，数量为 `2^9 = 512` 个，铁定是够的，嗯。
    * 把 `214.97.254/23` 写成二进制字符串
      * `214 = 128 + 64 + 16 + 4 + 2 = 11010110`
      * `97 = 64 + 32 + 1 = 01100001`
      * `254 = 11111110`
      * 即 `11010110 01100001 1111111` 
    * 子网 A 要 250 个接口，那就是要 8 个比特，子网 B 和 C 都要 120 个接口，那各自要 7 个比特
    
    | |地址范围| 子网前缀|
    |:---:|:---:|:---:|
    |A|`11010110 01100001 11111111 00000000` `11010110 01100001 11111111 11111111`| `214.97.255/24`|
    |B|`11010110 01100001 11111110 00000000` `11010110 01100001 11111110 01111000`| `214.97.254.0/25 ~ 214.97.254.0/29` `(把后面这个子网从前面的子网范围内抠掉)` |
    |C|`11010110 01100001 11111110 10000000` `11010110 01100001 11111110 11111111`| `214.97.254.128/25`|
    |D|`11010110 01100001 11111110 01111000` `11010110 01100001 11111110 01111001`| `214.97.254.0/31`|
    |E|`11010110 01100001 11111110 00000010` `11010110 01100001 11111110 00000011`| `214.97.254.2/31` |
    |F|`11010110 01100001 11111110 00000100` `11010110 01100001 11111110 00000101`| `214.97.254.4/31` |
    
#### P18 使用美国因特网编码注册机构 ([http://www.arin.net/whois](http://www.arin.net/whois))的 whois 服务来确定三所大学所用的 IP 地址块。whois 服务能被用于确定某个特定 IP 地址的确定地理位置吗？使用 www.maxmind.com 来确定位于这三所大学的 Web 服务器的位置。

// TODO

#### P19 考虑向具有 700 字节 MTU 的一条链路发送一个 2400 字节的数据报。假定初始数据报标有标示号 422。将会生成多少个分片？在生成相关分片的数据报中的各个字段中的值是多少？

|片|字节|标示号|标志|片偏移|
|:---:|:---:|:---:|:---:|:---:|
|第 1 片|680|422|1 (表示后面还有)|offset = 0|
|第 2 片|680|422|1|offset = 680|
|第 3 片|680|422|1|offset = 1360|
|第 4 片|360|422|0|offset = 2040|

#P19
        
    


  	
    
  


